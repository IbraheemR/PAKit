<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>UnPAKer</title>

    <link rel="stylesheet" href="style.css">

    <script>
        const {ipcRenderer} = require("electron");
        const {dialog} = require("electron").remote;

        window.$ = window.jQuery = require("jquery");
    </script>
</head>
<body>
    <select id="panel-select">
        <option id="unpak">UnPak</option>
        <option id="pak">Pak</option>
        <option id="configure">Settings</option>
    </select>

    <div id="panels">
        <form id="unpak">
            <h1>Unpack a .pak file</h1>
            <div>
                <div class="open-file" id="src">
                    <label>Source .pak</label>
                    <button >Select</button>
                    <label id="path"></label>
                </div>
                <div class="open-folder" id="exp">
                    <label>Destination Folder</label>
                    <button >Select</button>
                    <label id="path"></label>
                </div>
            </div>
            <button type="submit">Go!</button>

        </form>

        <form id="pak">
            <h1>Pack an assets folder...</h1>
            <div class="open-folder" id="src">
                <label>Source Folder</label>
                <button >Select</button>
                <label id="path"></label>
            </div>
            <div class="open-file" id="exp">
                <label>Destination .pak</label>
                <button >Select</button>
                <label id="path"></label>
            </div>
            <button type="submit">Go!</button>

        </form>

        <form id="configure">
            <h1>Configure settings</h1>

            <div>
                <div class="open-file" id="pakBin">
                    <label>"asset_packer" executable</label>
                    <button >Select</button>
                    <label id="path"></label>
                </div>
                <div class="open-file" id="unpakBin">
                    <label>"asset_unpacker" executable</label>
                    <button >Select</button>
                    <label id="path"></label>
                </div>
            </div>
            <button type="submit">Save</button>
            <button id="reset">Reset</button>
            <br><br><br><br>

            <div>

                Starbound .pak asset packer and unpacker tool, made by OBAN (Ibraheem Rodrigues).<br>
                All code/non-image files are distributed under the MIT license (https://opensource.org/licenses/MIT). All images belong to Chucklefish.<br>
                <br>
                Please donate that sweet garlic: GacWBGqzawm61FZdbTu2EbSSMKRC8i6QnZ
            </div>


        </form>
    </div>
    <div id="output">

    </div>

    <script>


        // Change which form is visible when select element is used
        $("#panel-select").change(() => {
            $("#panel-select option:selected").each(function() {
                $("form").hide();
                $(`form#${this.id}`).show();
            });
        });
        $("#panel-select").change() // Update to show the first item in the list

        // Bind form submit handlers
        $("form#pak button[type=submit]").click( (e) => {
            ipcRenderer.send("dopak", $("form#pak #src.open-folder #path").html(), $("form#pak #exp.open-file #path").html());
            return false;
        });
        $("form#unpak button[type=submit]").click( (e) => {
            ipcRenderer.send("dounpak", $("form#unpak #src.open-file #path").html(), $("form#unpak #exp.open-folder #path").html());
            return false;
        });
        $("form#configure button[type=submit]").click( (e) => {
            ipcRenderer.send("configure", $("form#configure #pakBin.open-file #path").html(), $("form#configure #unpakBin.open-file #path").html());
            return false;
        });
        $("form#configure button#reset").click( (e) => {
            ipcRenderer.send("reset");
            return false;
        });

        //Listen for messages
        ipcRenderer.on("message", (e, type, message) => {
            $("#output").html(message);
            $("#output").removeClass();
            $("#output").addClass(type);
        })

        //Listen for pak locations
        ipcRenderer.on("bins", (e, pakBin, unpakBin) => {
            $("form#configure #pakBin.open-file #path").html(pakBin);
            $("form#configure #unpakBin.open-file #path").html(unpakBin);
        })

        // Listen for signal lock buttons, while packing/unpacking
        ipcRenderer.on("lock", (e, pakBin, unpakBin) => {
            $("button").prop('disabled', true);
        })

        // Listen for signal to unlockbuttond buttons
        ipcRenderer.on("unlock", (e, pakBin, unpakBin) => {
            $("button").prop('disabled', false);
        })

        // Bind folder and .pak dialogs
        $(".open-folder button").click(function() {
            dialog.showOpenDialog(
                {
                    title: "Open Folder",
                    properties: [ 
                        "openDirectory", 
                        "createDirectory", 
                        "promptToCreate" 
                    ],
                },
                (paths) => {
                    if (paths) {
                        $(this).parent().children("#path").html(paths[0]);
                    }
                }
            );
        });
        $(".open-file button").click(function() {
            dialog.showOpenDialog(
                {
                    title: "Open .pak",
                    properties: [ 
                        "openFile", 
                        "createDirectory"
                    ],
                },
                (paths) => {
                    if (paths) {
                        $(this).parent().children("#path").html(paths[0]);
                    }
                }
            );
        });
    </script>
</body>
</html>